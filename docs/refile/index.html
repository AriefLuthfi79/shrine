<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Shrine for Refile Users · Shrine</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="This guide is aimed at helping Refile users transition to Shrine, and it consists"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Shrine for Refile Users · Shrine"/><meta property="og:type" content="website"/><meta property="og:url" content="https://shrinerb.com/"/><meta property="og:description" content="This guide is aimed at helping Refile users transition to Shrine, and it consists"/><meta property="og:image" content="https://shrinerb.com/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://shrinerb.com/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-149836844-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/version.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Shrine"/><h2 class="headerTitleWithLogo">Shrine</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started" target="_self">Guides</a></li><li class=""><a href="/docs/plugins/activerecord" target="_self">Plugins</a></li><li class=""><a href="/docs/external/extensions" target="_self">External</a></li><li class=""><a href="https://discourse.shrinerb.com" target="_self">Discourse</a></li><li class=""><a href="https://github.com/shrinerb/shrine" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Comparison</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Base</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/design">The Design of Shrine</a></li><li class="navListItem"><a class="navItem" href="/docs/retrieving-uploads">Retrieving Uploads</a></li><li class="navListItem"><a class="navItem" href="/docs/attacher">Using Attacher</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/direct-s3">Direct Uploads to S3</a></li><li class="navListItem"><a class="navItem" href="/docs/metadata">Extracting Metadata</a></li><li class="navListItem"><a class="navItem" href="/docs/processing">File Processing</a></li><li class="navListItem"><a class="navItem" href="/docs/validation">File Validation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extras</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/multiple-files">Multiple Files</a></li><li class="navListItem"><a class="navItem" href="/docs/securing-uploads">Securing uploads</a></li><li class="navListItem"><a class="navItem" href="/docs/testing">Testing with Shrine</a></li><li class="navListItem"><a class="navItem" href="/docs/upgrading-to-3">Upgrading to Shrine 3.x</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Migrating</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/changing-derivatives">Managing Derivatives</a></li><li class="navListItem"><a class="navItem" href="/docs/changing-location">Migrating File Locations</a></li><li class="navListItem"><a class="navItem" href="/docs/changing-storage">Migrating File Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extending</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/creating-plugins">Writing a Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/creating-persistence-plugins">Writing a Persistence Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/creating-storages">Writing a Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Comparison</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/advantages">Advantages of Shrine</a></li><li class="navListItem"><a class="navItem" href="/docs/carrierwave">Shrine for CarrierWave Users</a></li><li class="navListItem"><a class="navItem" href="/docs/paperclip">Shrine for Paperclip Users</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/refile">Shrine for Refile Users</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/shrinerb/shrine/edit/master/doc/refile.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Shrine for Refile Users</h1></header><article><div><span><p>This guide is aimed at helping Refile users transition to Shrine, and it consists
of three parts:</p>
<ol>
<li>Explanation of the key differences in design between Refile and Shrine</li>
<li>Instructions how to migrate and existing app that uses Refile to Shrine</li>
<li>Extensive reference of Refile's interface with Shrine equivalents</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>Shrine borrows many great concepts from Refile: Refile's &quot;backends&quot; are here
named &quot;storages&quot;, it uses the same IO abstraction for uploading and
representing uploaded files, similar attachment logic, and direct uploads are
supported as well.</p>
<h3><a class="anchor" aria-hidden="true" id="uploader"></a><a href="#uploader" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uploader</h3>
<p>While in Refile you work with storages directly, Shrine uses <em>uploaders</em> which
wrap storage uploads:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>storage&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>storages</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store</span></span><span class="punctuation section array end ruby"><span>]</span></span></span></div><div class="line"><span class="source ruby"><span>storage&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::Storage::S3&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>uploaded_file&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>upload</span><span class="punctuation section function ruby"><span>(</span></span><span>image</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store</span></span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>uploaded_file&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::UploadedFile&nbsp;...&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>uploaded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>storage&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::Storage::S3&gt;</span><span>&nbsp;</span></span></span></div></code></pre>
<p>This way, Shrine can perform tasks like generating location, extracting
metadata, processing, and logging, which are all storage-agnostic, and leave
storages to deal only with actual file storage. And these tasks can be
configured differently depending on the types of files you're uploading:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;add_metadata&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>exif</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>io</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class ruby"><span>MiniMagick</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Image</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span>io</span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>exif</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>VideoUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;add_metadata&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>duration</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>io</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class ruby"><span>FFMPEG</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Movie</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span>io</span><span class="punctuation separator method ruby"><span>.</span></span><span>path</span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>duration</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="url"></a><a href="#url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>URL</h4>
<p>While Refile serves all files through the Rack endpoint mounted in your app,
Shrine serves files directly from storage services:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Refile</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>attachment_url</span><span class="punctuation section function ruby"><span>(</span></span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>photo</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;/attachments/cache/50dfl833lfs0gfh.jpg&quot;</span><span>&nbsp;</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>photo</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>url&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;</span><span class="markup underline link https hyperlink"><span>https://my-bucket.s3.amazonaws.com/cache/50dfl833lfs0gfh.jpg</span></span><span>&quot;</span><span>&nbsp;</span></span></span></div></code></pre>
<p>If you're using storage which don't expose files over URL (e.g. a database
storage), or you want to secure your downloads, you can also serve files
through your app using the <a href="https://shrinerb.com/docs/plugins/download_endpoint"><code>download_endpoint</code></a> plugin.</p>
<h3><a class="anchor" aria-hidden="true" id="persistence"></a><a href="#persistence" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Persistence</h3>
<p>Refile persists the uploaded file location and metadata into individual
columns:</p>
<ul>
<li><code>&lt;attachment&gt;_id</code></li>
<li><code>&lt;attachment&gt;_filename</code></li>
<li><code>&lt;attachment&gt;_content_type</code></li>
<li><code>&lt;attachment&gt;_size</code></li>
</ul>
<p>Shrine, on the other hand, saves all uploaded file data into a single
<code>&lt;attachment&gt;_data</code> column:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>id</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator other ruby"><span>:</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>path/to/image.jpg</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>storage</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator other ruby"><span>:</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>store</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>metadata</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator other ruby"><span>:</span></span><span>&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>filename</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator other ruby"><span>:</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>nature.jpg</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>size</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator other ruby"><span>:</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>4739472</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>mime_type</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator other ruby"><span>:</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>image/jpeg</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="punctuation section scope end ruby"><span>}</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation section scope end ruby"><span>}</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;path/to/image.jpg&quot;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>storage_key&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;:store</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>metadata&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;{&nbsp;&quot;filename&quot;&nbsp;=&gt;&nbsp;&quot;...&quot;,&nbsp;&quot;size&quot;&nbsp;=&gt;&nbsp;...,&nbsp;&quot;mime_type&quot;&nbsp;=&gt;&nbsp;&quot;...&quot;&nbsp;}</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>original_filename&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;nature.jpg&quot;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>size&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;4739472</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>mime_type&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;image/jpeg&quot;</span><span>&nbsp;</span></span></span></div></code></pre>
<p>This column can be queried if it's made a JSON column. Alternatively, you can
use the <a href="https://shrinerb.com/docs/plugins/metadata_attributes"><code>metadata_attributes</code></a> plugin to save metadata
into separate columns.</p>
<h3><a class="anchor" aria-hidden="true" id="processing"></a><a href="#processing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Processing</h3>
<p>Shrine provides on-the-fly processing via the
<a href="https://shrinerb.com/docs/plugins/derivation_endpoint"><code>derivation_endpoint</code></a> plugin:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;config/routes.rb&nbsp;(Rails)</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Rails</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>application</span><span class="punctuation separator method ruby"><span>.</span></span><span>routes</span><span class="punctuation separator method ruby"><span>.</span></span><span>draw&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby"><span>&nbsp;&nbsp;</span></span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;mount&nbsp;</span><span class="support class ruby"><span>ImageUploader</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>derivation_endpoint&nbsp;</span><span class="punctuation separator key-value"><span>=&gt;</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>/derivations/image</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby"><span>require</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>image_processing/mini_magick</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>derivation_endpoint</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>secret_key</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>&lt;YOUR&nbsp;SECRET&nbsp;KEY&gt;</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>prefix</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>derivations/image</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;needs&nbsp;to&nbsp;match&nbsp;the&nbsp;mount&nbsp;point&nbsp;in&nbsp;routes</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;derivation&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>thumbnail</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>file</span></span><span class="punctuation separator variable ruby"><span>,</span></span><span>&nbsp;</span><span class="variable other block ruby"><span>width</span></span><span class="punctuation separator variable ruby"><span>,</span></span><span>&nbsp;</span><span class="variable other block ruby"><span>height</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class ruby"><span>ImageProcessing</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>MiniMagick</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>source</span><span class="punctuation section function ruby"><span>(</span></span><span>file</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit!</span><span class="punctuation section function ruby"><span>(</span></span><span>width</span><span class="punctuation separator method ruby"><span>.</span></span><span>to_i</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;height</span><span class="punctuation separator method ruby"><span>.</span></span><span>to_i</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>Shrine also support processing up front using the <a href="https://shrinerb.com/docs/plugins/derivatives"><code>derivatives</code></a>
plugin.</p>
<h3><a class="anchor" aria-hidden="true" id="validation"></a><a href="#validation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Validation</h3>
<p>In Refile, file validation is defined statically on attachment definition:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>Photo</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Sequel::Model</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;attachment&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>extension</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>jpg&nbsp;jpeg&nbsp;png&nbsp;webp</span><span class="punctuation section array end ruby"><span>]</span></span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>content_type</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>image/jpeg&nbsp;image/png&nbsp;image/webp</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>In Shrine, validation is performed on the instance-level, which allows you to
make the validation conditional:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>validation_helpers</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>validate&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_max_size&nbsp;</span><span class="constant numeric ruby"><span>10</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span class="constant numeric ruby"><span>1024</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span class="constant numeric ruby"><span>1024</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_extension&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>jpg&nbsp;jpeg&nbsp;png&nbsp;webp</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;validate_mime_type&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>image/jpeg&nbsp;image/png&nbsp;image/webp</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validate_max_dimensions&nbsp;</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="constant numeric ruby"><span>5000</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>5000</span></span><span class="punctuation section array end ruby"><span>]</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>Refile extracts the MIME type from the file extension, which means it can
easily be spoofed (just give a PHP file a <code>.jpg</code> extension). Shrine has the
<a href="https://shrinerb.com/docs/plugins/determine_mime_type"><code>determine_mime_type</code></a> plugin for determining MIME type
from file <em>content</em>.</p>
<h3><a class="anchor" aria-hidden="true" id="direct-uploads"></a><a href="#direct-uploads" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Direct uploads</h3>
<p>Shrine borrows Refile's idea of direct uploads, and ships with
<code>upload_endpoint</code> and <code>presign_endpoint</code> plugins which provide endpoints for
uploading files and generating presigns.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>upload_endpoint</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>upload_endpoint</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>cache</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;Rack&nbsp;app&nbsp;that&nbsp;uploads&nbsp;files&nbsp;to&nbsp;specified&nbsp;storage</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>upload_endpoint</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>presign_endpoint</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>cache</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;Rack&nbsp;app&nbsp;that&nbsp;generates&nbsp;presigns&nbsp;for&nbsp;specified&nbsp;storage</span><span>&nbsp;</span></span></span></div></code></pre>
<p>While Refile ships with a plug-and-play JavaScript for direct uploads, Shrine
instead adopts <a href="https://uppy.io">Uppy</a>, a modern and modular JavaScript file upload library that
happens to integrate well with Shrine.</p>
<h3><a class="anchor" aria-hidden="true" id="multiple-uploads"></a><a href="#multiple-uploads" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Multiple uploads</h3>
<p>Shrine doesn't have support for multiple uploads out-of-the-box like Refile
does. Instead, you can implement them using a separate table with a one-to-many
relationship to which the files will be attached. The <a href="https://shrinerb.com/docs/multiple-files">Multiple Files</a> guide
explains this setup in more detail.</p>
<h2><a class="anchor" aria-hidden="true" id="migrating-from-refile"></a><a href="#migrating-from-refile" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Migrating from Refile</h2>
<p>You have an existing app using Refile and you want to transfer it to
Shrine. Let's assume we have a <code>Photo</code> model with the &quot;image&quot; attachment. First
we need to create the <code>image_data</code> column for Shrine:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>add_column&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>photos</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image_data</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>text</span></span></span></div></code></pre>
<p>Afterwards we need to make new uploads write to the <code>image_data</code> column. This
can be done by including the below module to all models that have Refile
attachments:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby"><span>require</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>shrine</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>storages&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>cache</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="punctuation separator method ruby"><span>.</span><span>.</span><span>.</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>store</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="punctuation separator method ruby"><span>.</span><span>.</span><span>.</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation section scope end ruby"><span>}</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>model</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta module ruby"><span class="keyword control module ruby"><span>module</span></span><span>&nbsp;</span><span class="entity name type module ruby"><span>RefileShrineSynchronization</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="meta function method with-arguments ruby"><span class="keyword control def ruby"><span>def</span></span><span>&nbsp;</span><span class="entity name function ruby"><span>write_shrine_data</span></span><span class="punctuation definition parameters ruby"><span>(</span></span><span class="variable parameter function ruby"><span>name</span></span><span class="punctuation definition parameters ruby"><span>)</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;attacher&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>from_model</span><span class="punctuation section function ruby"><span>(</span></span><span class="variable language self ruby"><span>self</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;name</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;read_attribute</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_id</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>present?</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attacher</span><span class="punctuation separator method ruby"><span>.</span></span><span>set&nbsp;shrine_file</span><span class="punctuation section function ruby"><span>(</span></span><span>name</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>else</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;attacher</span><span class="punctuation separator method ruby"><span>.</span></span><span>set&nbsp;</span><span class="constant language nil ruby"><span>nil</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="meta function method with-arguments ruby"><span class="keyword control def ruby"><span>def</span></span><span>&nbsp;</span><span class="entity name function ruby"><span>shrine_file</span></span><span class="punctuation definition parameters ruby"><span>(</span></span><span class="variable parameter function ruby"><span>name</span></span><span class="punctuation definition parameters ruby"><span>)</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>uploaded_file</span><span class="punctuation section function ruby"><span>(</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>storage</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>id</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;send</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_id</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>metadata</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>size</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator key-value"><span>=&gt;</span></span><span>&nbsp;</span><span class="punctuation section function ruby"><span>(</span></span><span>send</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_size</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;respond_to?</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_size</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>filename</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span>&nbsp;&nbsp;</span><span class="punctuation separator key-value"><span>=&gt;</span></span><span>&nbsp;</span><span class="punctuation section function ruby"><span>(</span></span><span>send</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_filename</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;respond_to?</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_filename</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>mime_type</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span>&nbsp;</span><span class="punctuation separator key-value"><span>=&gt;</span></span><span>&nbsp;</span><span class="punctuation section function ruby"><span>(</span></span><span>send</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_content_type</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;respond_to?</span><span class="punctuation section function ruby"><span>(</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span class="meta embedded line ruby"><span class="punctuation section embedded begin ruby"><span class="source ruby"><span>#{</span></span></span><span class="source ruby"><span>name</span></span><span class="punctuation section embedded end ruby"><span class="source ruby"><span>}</span></span></span></span><span>_content_type</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section function ruby"><span>)</span><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end ruby"><span>}</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>Photo</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;ActiveRecord::Base</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;attachment&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword other special-method ruby"><span>include</span></span><span>&nbsp;</span><span class="variable other constant ruby"><span>RefileShrineSynchronization</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;before_save&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;write_shrine_data</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;image_id_changed?</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>After you deploy this code, the <code>image_data</code> column should now be successfully
synchronized with new attachments.  Next step is to run a script which writes
all existing Refile attachments to <code>image_data</code>:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Photo</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>find_each&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>photo</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>write_shrine_data</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image</span></span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>save!</span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>Now you should be able to rewrite your application so that it uses Shrine
instead of Refile, using equivalent Shrine storages. For help with translating
the code from Refile to Shrine, you can consult the reference below.</p>
<h2><a class="anchor" aria-hidden="true" id="refile-to-shrine-direct-mapping"></a><a href="#refile-to-shrine-direct-mapping" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refile to Shrine direct mapping</h2>
<h3><a class="anchor" aria-hidden="true" id="refile"></a><a href="#refile" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>Refile</code></h3>
<h4><a class="anchor" aria-hidden="true" id="cache-store-backends"></a><a href="#cache-store-backends" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.cache</code>, <code>.store</code>, <code>.backends</code></h4>
<p>Shrine calles these &quot;storages&quot;, and it doesn't have special accessors for
<code>:cache</code> and <code>:store</code>:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>storages&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>cache</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Storage</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Foo</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span>args</span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>store</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Storage</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Bar</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span>args</span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation section scope end ruby"><span>}</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="app-mount_point-automount"></a><a href="#app-mount_point-automount" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.app</code>, <code>.mount_point</code>, <code>.automount</code></h4>
<p>The Rack apps provided by the <code>*_endpoint</code> Shrine plugins are mounted
explicitly:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;config/routes.rb</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Rails</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>application</span><span class="punctuation separator method ruby"><span>.</span></span><span>routes</span><span class="punctuation separator method ruby"><span>.</span></span><span>draw&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby"><span>&nbsp;&nbsp;</span></span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;adds&nbsp;`POST&nbsp;/images/upload`&nbsp;endpoint</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;mount&nbsp;</span><span class="support class ruby"><span>ImageUploader</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>upload_endpoint</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>cache</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="punctuation separator key-value"><span>=&gt;</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>/images/upload</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="allow_uploads_to"></a><a href="#allow_uploads_to" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.allow_uploads_to</code></h4>
<p>The <code>Shrine.upload_endpoint</code> and <code>Shrine.presign_endpoint</code> builders require you
to specify the storage that will be used.</p>
<h4><a class="anchor" aria-hidden="true" id="logger"></a><a href="#logger" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.logger</code></h4>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>logger</span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="processors-processor"></a><a href="#processors-processor" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.processors</code>, <code>.processor</code></h4>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>derivatives</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;derivation&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>thumbnail</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>file</span></span><span class="punctuation separator variable ruby"><span>,</span></span><span>&nbsp;</span><span class="variable other block ruby"><span>width</span></span><span class="punctuation separator variable ruby"><span>,</span></span><span>&nbsp;</span><span class="variable other block ruby"><span>height</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="types"></a><a href="#types" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.types</code></h4>
<p>Shrine defines validations on the uploader class level:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>MyUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>validation_helpers</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>validate&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_max_size&nbsp;</span><span class="constant numeric ruby"><span>5</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span class="constant numeric ruby"><span>1024</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span class="constant numeric ruby"><span>1024</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="extract_filename"></a><a href="#extract_filename" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.extract_filename</code></h4>
<p>Shrine's equivalent is a <code>Shrine#extract_filename</code> private method. You can
instead use the <code>Shrine#extract_metadata</code> public method.</p>
<h4><a class="anchor" aria-hidden="true" id="extract_content_type"></a><a href="#extract_content_type" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.extract_content_type</code></h4>
<p>The <a href="https://shrinerb.com/docs/plugins/determine_mime_type"><code>determine_mime_type</code></a> plugin provides a
<code>Shrine.determine_mime_type</code> method.</p>
<h4><a class="anchor" aria-hidden="true" id="app_url-upload_url-attachment_upload_url-presign_url-attachment_presign_url"></a><a href="#app_url-upload_url-attachment_upload_url-presign_url-attachment_presign_url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.app_url</code>, <code>.upload_url</code>, <code>.attachment_upload_url</code>, <code>.presign_url</code>, <code>.attachment_presign_url</code></h4>
<p>Shrine requires you to use your framework to generate URLs to mounted
endpoints.</p>
<h4><a class="anchor" aria-hidden="true" id="attachment_url-file_url"></a><a href="#attachment_url-file_url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.attachment_url</code>, <code>.file_url</code></h4>
<p>You can call <code>#url</code> on the uploaded file, or <code>#&lt;name&gt;_url</code> on the model.
Alternatively, you can use <code>#download_url</code> provided by the <code>download_endpoint</code>
plugin.</p>
<h4><a class="anchor" aria-hidden="true" id="host-cdn_host-app_host-allow_downloads_from-allow_origin-content_max_age"></a><a href="#host-cdn_host-app_host-allow_downloads_from-allow_origin-content_max_age" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.host</code>, <code>.cdn_host</code>, <code>.app_host</code>, <code>.allow_downloads_from</code>, <code>allow_origin</code>, <code>.content_max_age</code></h4>
<p>These can be configured on individual <code>*_endpoint</code> plugins.</p>
<h4><a class="anchor" aria-hidden="true" id="secret_key-token-valid_token"></a><a href="#secret_key-token-valid_token" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>.secret_key</code>, <code>.token</code>, <code>.valid_token?</code></h4>
<p>The secret key is required for the
<a href="https://shrinerb.com/docs/plugins/derivation_endpoint"><code>derivation_endpoint</code></a>, but these methods are not
exposed.</p>
<h3><a class="anchor" aria-hidden="true" id="attachment"></a><a href="#attachment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>Attachment</code></h3>
<p>Shrine's equivalent to calling the attachment is including an attachment module
of an uploader:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>Photo</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword other special-method ruby"><span>include</span></span><span>&nbsp;</span><span class="support class ruby"><span>ImageUploader</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>Attachment</span></span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>image</span></span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="extension-content_type-type"></a><a href="#extension-content_type-type" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>:extension</code>, <code>:content_type</code>, <code>:type</code></h4>
<p>In Shrine validations are done instance-level inside the uploader, most
commonly with the <code>validation_helpers</code> plugin:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>validation_helpers</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>validate&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_extension&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>jpg&nbsp;jpeg&nbsp;png</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_mime_type&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>image/jpeg&nbsp;image/png</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="cache-store"></a><a href="#cache-store" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>:cache</code>, <code>:store</code></h4>
<p>Shrine provides a <code>default_storage</code> plugin for setting custom storages on the
uploader:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>storages</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>custom_cache</span></span><span class="punctuation section array end ruby"><span>]</span></span><span>&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Storage</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Foo</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span>args</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>storages</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>custom_store</span></span><span class="punctuation section array end ruby"><span>]</span></span><span>&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Storage</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Bar</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span>args</span><span class="punctuation section function ruby"><span>)</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>default_storage</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>cache</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>custom_cache</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>store</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>custom_store</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="raise_errors"></a><a href="#raise_errors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>:raise_errors</code></h4>
<p>No equivalent currently exists in Shrine.</p>
<h3><a class="anchor" aria-hidden="true" id="accepts_attachments_for"></a><a href="#accepts_attachments_for" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>accepts_attachments_for</code></h3>
<p>No equivalent in Shrine, but take a look at the <a href="https://shrinerb.com/docs/multiple-files">Multiple Files</a> guide.</p>
<h3><a class="anchor" aria-hidden="true" id="form-helpers"></a><a href="#form-helpers" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Form helpers</h3>
<h4><a class="anchor" aria-hidden="true" id="attachment_field"></a><a href="#attachment_field" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>attachment_field</code></h4>
<p>The following Refile code</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>form_for&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>form</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>attachment_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>is equivalent to the following Shrine code</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>cached_attachment_data</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>form_for&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>form</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>hidden_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>value</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>cached_profile_image_data</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>file_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h3><a class="anchor" aria-hidden="true" id="model-methods"></a><a href="#model-methods" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Model methods</h3>
<h4><a class="anchor" aria-hidden="true" id="remove_-attachment"></a><a href="#remove_-attachment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>remove_&lt;attachment&gt;</code></h4>
<p>Shrine comes with a <code>remove_attachment</code> plugin which adds the same
<code>#remove_&lt;attachment&gt;</code> method to the model.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>remove_attachment</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>form_for&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>form</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>hidden_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>value</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>cached_profile_image_data</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>file_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>check_box&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>remove_profile_image</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h4><a class="anchor" aria-hidden="true" id="remote_-attachment-_url"></a><a href="#remote_-attachment-_url" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>remote_&lt;attachment&gt;_url</code></h4>
<p>Shrine comes with a <code>remote_url</code> plugin which adds the same
<code>#&lt;attachment&gt;_remote_url</code> method to the model.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>remote_url</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>form_for&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>form</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>hidden_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>value</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="variable other readwrite instance ruby"><span class="punctuation definition variable ruby"><span>@</span></span><span>user</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>cached_profile_image_data</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>file_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;form</span><span class="punctuation separator method ruby"><span>.</span></span><span>text_field&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>profile_image_remote_url</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/paperclip"><span class="arrow-prev">← </span><span>Shrine for Paperclip Users</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a><ul class="toc-headings"><li><a href="#uploader">Uploader</a></li><li><a href="#persistence">Persistence</a></li><li><a href="#processing">Processing</a></li><li><a href="#validation">Validation</a></li><li><a href="#direct-uploads">Direct uploads</a></li><li><a href="#multiple-uploads">Multiple uploads</a></li></ul></li><li><a href="#migrating-from-refile">Migrating from Refile</a></li><li><a href="#refile-to-shrine-direct-mapping">Refile to Shrine direct mapping</a><ul class="toc-headings"><li><a href="#refile"><code>Refile</code></a></li><li><a href="#attachment"><code>Attachment</code></a></li><li><a href="#accepts_attachments_for"><code>accepts_attachments_for</code></a></li><li><a href="#form-helpers">Form helpers</a></li><li><a href="#model-methods">Model methods</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer" data-version="3.0.1"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="Shrine" width="66"/></a><div><h5>Docs</h5><a href="/guides">Guides</a><a href="/plugins">Plugins</a><a href="/external">External</a><a href="https://github.com/shrinerb/shrine/blob/master/CONTRIBUTING.md#readme">Contributing</a></div><div><h5>Community</h5><a href="https://discourse.shrinerb.com" target="_blank" rel="noreferrer noopener">Discourse</a><a href="https://stackoverflow.com/questions/tagged/shrine" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://twin.github.io">Blog</a><a href="https://github.com/shrinerb/shrine">GitHub</a><a class="github-button" href="https://github.com/shrinerb/shrine" data-icon="octicon-star" data-count-href="/shrinerb/shrine/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/shrine_rb" class="twitter-follow-button">Follow @shrine_rb</a></div></div></section><section class="copyright">Copyright © 2019 Janko Marohnić</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '09a11b10801874df7d226df4f2ce8e8f',
                indexName: 'shrinerb',
                inputSelector: '#search_input_react'
              });
            </script></body></html>