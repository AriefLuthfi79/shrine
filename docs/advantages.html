<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Advantages of Shrine · Shrine</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="There are many existing file upload solutions for Ruby out there. This guide"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Advantages of Shrine · Shrine"/><meta property="og:type" content="website"/><meta property="og:url" content="https://shrinerb.com/"/><meta property="og:description" content="There are many existing file upload solutions for Ruby out there. This guide"/><meta property="og:image" content="https://shrinerb.com/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://shrinerb.com/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-149836844-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/version.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Shrine"/><h2 class="headerTitleWithLogo">Shrine</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started" target="_self">Guides</a></li><li class=""><a href="/docs/plugins/activerecord" target="_self">Plugins</a></li><li class=""><a href="/docs/external/extensions" target="_self">External</a></li><li class=""><a href="https://discourse.shrinerb.com" target="_self">Discourse</a></li><li class=""><a href="https://github.com/shrinerb/shrine" target="_self">GitHub</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Comparison</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Base</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/design">The Design of Shrine</a></li><li class="navListItem"><a class="navItem" href="/docs/retrieving-uploads">Retrieving Uploads</a></li><li class="navListItem"><a class="navItem" href="/docs/attacher">Using Attacher</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Features</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/direct-s3">Direct Uploads to S3</a></li><li class="navListItem"><a class="navItem" href="/docs/metadata">Extracting Metadata</a></li><li class="navListItem"><a class="navItem" href="/docs/processing">File Processing</a></li><li class="navListItem"><a class="navItem" href="/docs/validation">File Validation</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extras</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/multiple-files">Multiple Files</a></li><li class="navListItem"><a class="navItem" href="/docs/securing-uploads">Securing uploads</a></li><li class="navListItem"><a class="navItem" href="/docs/testing">Testing with Shrine</a></li><li class="navListItem"><a class="navItem" href="/docs/upgrading-to-3">Upgrading to Shrine 3.x</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Migrating</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/changing-derivatives">Managing Derivatives</a></li><li class="navListItem"><a class="navItem" href="/docs/changing-location">Migrating File Locations</a></li><li class="navListItem"><a class="navItem" href="/docs/changing-storage">Migrating File Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Extending</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/creating-plugins">Writing a Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/creating-persistence-plugins">Writing a Persistence Plugin</a></li><li class="navListItem"><a class="navItem" href="/docs/creating-storages">Writing a Storage</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Comparison</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/docs/advantages">Advantages of Shrine</a></li><li class="navListItem"><a class="navItem" href="/docs/carrierwave">Shrine for CarrierWave Users</a></li><li class="navListItem"><a class="navItem" href="/docs/paperclip">Shrine for Paperclip Users</a></li><li class="navListItem"><a class="navItem" href="/docs/refile">Shrine for Refile Users</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/shrinerb/shrine/edit/master/doc/advantages.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Advantages of Shrine</h1></header><article><div><span><p>There are many existing file upload solutions for Ruby out there. This guide
will attempt to cover some of the main advantages that Shrine offers compared
to these alternatives.</p>
<p>For a more direct comparison with specific file attachment libraries, there are
more specialized guides for <a href="https://shrinerb.com/docs/carrierwave">CarrierWave</a>, <a href="https://shrinerb.com/docs/paperclip">Paperclip</a>, and <a href="https://shrinerb.com/docs/refile">Refile</a> users.</p>
<h2><a class="anchor" aria-hidden="true" id="generality"></a><a href="#generality" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Generality</h2>
<p>Many alternative file upload solutions are coupled to either Rails (Active
Storage) or Active Record itself (Paperclip, Dragonfly). This is not ideal, as
Rails-specific solutions fragment the Ruby community between developers that
use Rails and developers that don't. There are many great web frameworks
(<a href="http://sinatrarb.com">Sinatra</a>, <a href="http://roda.jeremyevans.net">Roda</a>, <a href="http://cuba.is">Cuba</a>, <a href="http://hanamirb.org">Hanami</a>, <a href="https://github.com/ruby-grape/grape">Grape</a>) and persistence libraries
(<a href="http://sequel.jeremyevans.net">Sequel</a>, <a href="http://rom-rb.org">ROM</a>, <a href="https://github.com/hanami/model">Hanami::Model</a>) out there that people use instead of Rails
and Active Record.</p>
<p>Shrine, on the other hand, doesn't make any assumptions about which web
framework or persistence library you're using. Any web-specific functionality
is implemented on top of <a href="https://rack.github.io">Rack</a>, the Ruby web server interface that powers all
the popular Ruby web frameworks (including Rails). The integrations for
specific ORMs are provided as plugins.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;Rack-based&nbsp;plugins</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>upload_endpoint</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>presign_endpoint</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>download_endpoint</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>derivation_endpoint</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>rack_response</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>rack_file</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;ORM&nbsp;plugins</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>activerecord</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>sequel</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>mongoid</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/shrinerb/shrine-mongoid</span></span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>rom</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/shrinerb/shrine-rom</span></span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>hanami</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;</span><span class="markup underline link https hyperlink"><span>https://github.com/katafrakt/hanami-shrine</span></span><span>&nbsp;</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="simplicity"></a><a href="#simplicity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Simplicity</h2>
<p>Where some popular file attachment libraries have <a href="https://en.wikipedia.org/wiki/God_object">god objects</a>
(<code>CarrierWave::Uploader::Base</code> and <code>Paperclip::Attachment</code>), Shrine distributes
responsibilities across multiple core classes:</p>
<table>
<thead>
<tr><th style="text-align:left">Class</th><th style="text-align:left">Description</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><code>Shrine::Storage::*</code></td><td style="text-align:left">Encapsulate file operations for the underlying service</td></tr>
<tr><td style="text-align:left"><code>Shrine</code></td><td style="text-align:left">Wraps uploads and handles loading plugins</td></tr>
<tr><td style="text-align:left"><code>Shrine::UploadedFile</code></td><td style="text-align:left">Represents a file that was uploaded to a storage</td></tr>
<tr><td style="text-align:left"><code>Shrine::Attacher</code></td><td style="text-align:left">Handles attaching files to records</td></tr>
<tr><td style="text-align:left"><code>Shrine::Attachment</code></td><td style="text-align:left">Adds convenience attachment methods to model instances</td></tr>
</tbody>
</table>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::UploadedFile&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>storage&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::Storage::S3&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>uploader&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image_attacher&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::Attacher&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>class</span><span class="punctuation separator method ruby"><span>.</span></span><span>ancestors&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;[...,&nbsp;#&lt;Shrine::Attachment(:image)&gt;,&nbsp;...]</span><span>&nbsp;</span></span></span></div></code></pre>
<p>The attachment functionality is decoupled from persistence and storage, which
makes it much easier to reason about. Also, special care was taken to make
integrating new storages and persistence libraries as easy as possible.</p>
<h2><a class="anchor" aria-hidden="true" id="modularity"></a><a href="#modularity" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Modularity</h2>
<p>Shrine uses a <a href="https://twin.github.io/the-plugin-system-of-sequel-and-roda/">plugin system</a> that allows you to pick and choose the features
that you want. Moreover, you'll only be loading code for the features you've
selected, which means that Shrine will generally load much faster than the
alternatives.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>instrumentation</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;which&nbsp;translates&nbsp;to</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby"><span>require</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>shrine/plugins/instrumentation</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Plugins</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>Instrumentation</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>method</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>instrument</span></span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>owner&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;Shrine::Plugins::Instrumentation::ClassMethods</span><span>&nbsp;</span></span></span></div></code></pre>
<p>Shrine recommends a certain type of attachment flow, but it still offers good
low-level abstractions that give you the flexibility to build your own flow.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>uploaded_file&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>ImageUploader</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>upload</span><span class="punctuation section function ruby"><span>(</span></span><span>image</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;metadata&nbsp;extraction,&nbsp;upload&nbsp;location&nbsp;generation</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>uploaded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>id&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;44ccafc10ce6a4ff22829e8f579ee6b9.jpg&quot;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>uplaoded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>metadata&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;{&nbsp;...&nbsp;extracted&nbsp;metadata&nbsp;...&nbsp;}</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>data&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;uploaded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>to_json&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;serialization</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>uploaded_file&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>ImageUploader</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>uploaded_file</span><span class="punctuation section function ruby"><span>(</span></span><span>data</span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;deserialization</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>uploaded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>url&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;https://...&quot;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>uploaded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>download&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>tempfile</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span>&nbsp;</span><span class="punctuation separator method ruby"><span>.</span><span>.</span><span>.</span></span><span>&nbsp;</span><span class="punctuation section scope end ruby"><span>}</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;streaming&nbsp;download</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>uploaded_file</span><span class="punctuation separator method ruby"><span>.</span></span><span>delete</span></span></div></code></pre>
<h3><a class="anchor" aria-hidden="true" id="dependencies"></a><a href="#dependencies" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependencies</h3>
<p>Shrine is very diligent when it comes to dependencies. It has two mandatory
dependencies – <a href="https://github.com/janko/down">Down</a> and <a href="https://github.com/shrinerb/content_disposition">ContentDisposition</a> – which are loaded only by
components that need them. Some Shrine plugins also require additional
dependencies, but you only need to load them if you're using those plugins.</p>
<p>Moreover, Shrine often gives you the ability choose between multiple
alternative dependencies for doing the same task. For example, the
<code>determine_mime_type</code> plugin allows you to choose between the <a href="http://linux.die.net/man/1/file"><code>file</code></a> command,
<a href="https://github.com/blackwinter/ruby-filemagic">FileMagic</a>, <a href="https://github.com/sdsykes/fastimage">FastImage</a>, <a href="https://github.com/minad/mimemagic">MimeMagic</a>, or <a href="https://github.com/basecamp/marcel">Marcel</a> gem for determining the MIME
type, while the <code>store_dimensions</code> plugin can extract dimensions using
<a href="https://github.com/sdsykes/fastimage">FastImage</a>, <a href="https://github.com/minimagick/minimagick">MiniMagick</a>, or <a href="https://github.com/libvips/ruby-vips">ruby-vips</a> gem.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>determine_mime_type</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>analyzer</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>marcel</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store_dimensions</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>analyzer</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>mini_magick</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="inheritance"></a><a href="#inheritance" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Inheritance</h2>
<p>Shrine is designed to handle any types of files. If you're accepting uploads of
multiple types of files, such as videos and images, chances are that the logic
for handling them will differ:</p>
<ul>
<li>small images can be processed on-the-fly, but large files should be processed in a background job</li>
<li>you might want to store different files to different storage services (images, documents, audios, videos)</li>
<li>extracting metadata might require different tools depending on the filetype</li>
</ul>
<p>With Shrine you can create isolated uploaders for each type of file. For
features you want all uploaders to share, their plugins can be loaded globally,
while other plugins you can load only for selected uploaders.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;loaded&nbsp;for&nbsp;all&nbsp;plugins</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>activerecord</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>instrumentation</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby"><span>&nbsp;&nbsp;</span></span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;loaded&nbsp;only&nbsp;for&nbsp;ImageUploader</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store_dimensions</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>VideoUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby"><span>&nbsp;&nbsp;</span></span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;loaded&nbsp;only&nbsp;for&nbsp;VideoUploader</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>default_storage</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>store</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>vimeo</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="processing"></a><a href="#processing" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Processing</h2>
<p>Most file attachment libraries provide either processing files up front
(Paperclip, CarrierWave) or on-the-fly (Dragonfly, Refile, Active Storage).
However, each approach is suitable for different requirements. For instance,
while on-the-fly processing is suitable for fast processing (image thumbnails,
document previews), longer running processing (video transcoding, raw images)
should be moved into a background job.</p>
<p>That's why Shrine supports both <a href="https://shrinerb.com/docs/plugins/derivatives">up front</a> and
<a href="https://shrinerb.com/docs/plugins/derivation_endpoint">on-the-fly</a> processing. For example, if you're handling
image uploads, you can choose to either generate a set of pre-defined
thumbnails during attachment:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>derivatives_processor&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>original</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;magick&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>ImageProcessing</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>MiniMagick</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>source</span><span class="punctuation section function ruby"><span>(</span></span><span>original</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>large</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;&nbsp;magick</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit!</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant numeric ruby"><span>800</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>800</span></span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>medium</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;magick</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit!</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant numeric ruby"><span>500</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>500</span></span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="constant other symbol hashkey ruby"><span>small</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;&nbsp;magick</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit!</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant numeric ruby"><span>300</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>300</span></span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator object ruby"><span>,</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope end ruby"><span>}</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image_derivatives!&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;creates&nbsp;thumbnails</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image_url</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>large</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;</span><span class="markup underline link https hyperlink"><span>https://s3.amazonaws.com/path/to/large.jpg</span></span><span>&quot;</span><span>&nbsp;</span></span></span></div></code></pre>
<p>or generate thumbnails on-demand:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;derivation&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>thumbnail</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>file</span></span><span class="punctuation separator variable ruby"><span>,</span></span><span>&nbsp;</span><span class="variable other block ruby"><span>width</span></span><span class="punctuation separator variable ruby"><span>,</span></span><span>&nbsp;</span><span class="variable other block ruby"><span>height</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="support class ruby"><span>ImageProcessing</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>MiniMagick</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>source</span><span class="punctuation section function ruby"><span>(</span></span><span>file</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit!</span><span class="punctuation section function ruby"><span>(</span></span><span>width</span><span class="punctuation separator method ruby"><span>.</span></span><span>to_i</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;height</span><span class="punctuation separator method ruby"><span>.</span></span><span>to_i</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>derivation_url</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>thumbnail</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>600</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>400</span></span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;&quot;.../thumbnail/600/400/eyJpZCI6ImZvbyIsInN0b3JhZ2UiOiJzdG9yZSJ9?signature=...&quot;</span><span>&nbsp;</span></span></span></div></code></pre>
<h3><a class="anchor" aria-hidden="true" id="imagemagick"></a><a href="#imagemagick" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ImageMagick</h3>
<p>Many file attachment libraries, such as CarrierWave, Paperclip, Dragonfly and
Refile, implement their own image processing macros. Rather than building yet
another in-house implementation, a general purpose <strong><a href="https://github.com/janko/image_processing">ImageProcessing</a></strong> gem
was created instead, which works great with Shrine.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby"><span>require</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>image_processing/mini_magick</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>thumbnail&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>ImageProcessing</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>MiniMagick</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>source</span><span class="punctuation section function ruby"><span>(</span></span><span>image</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant numeric ruby"><span>400</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>400</span></span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>call&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;convert&nbsp;input.jpg&nbsp;-auto-orient&nbsp;-resize&nbsp;400x400&gt;&nbsp;-sharpen&nbsp;0x1&nbsp;output.jpg</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>thumbnail&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Tempfile:/var/folders/.../image_processing20180316-18446-1j247h6.jpg&gt;</span><span>&nbsp;</span></span></span></div></code></pre>
<p>It takes care of many details for you, such as <a href="https://www.imagemagick.org/script/command-line-options.php#auto-orient">auto orienting</a> the input image
and applying <a href="https://photography.tutsplus.com/tutorials/what-is-image-sharpening--cms-26627">sharpening</a> to resized images. It also has support for
<a href="#libvips">libvips</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="libvips"></a><a href="#libvips" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>libvips</h3>
<p><strong><a href="http://libvips.github.io/libvips/">libvips</a></strong> is a full-featured image processing library like ImageMagick,
with <a href="https://github.com/libvips/libvips/wiki/Speed-and-memory-use#results">great performance characteristics</a>. It's often
<strong>multiple times faster</strong> than ImageMagick, and also has lower memory usage.
For more details, see <a href="https://github.com/libvips/libvips/wiki/Why-is-libvips-quick">Why is libvips quick</a>.</p>
<p>The ImageProcessing gem provides libvips support as an alternative
<code>ImageProcessing::Vips</code> backend, sharing the same API as the
<code>ImageProcessing::MiniMagick</code> backend.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby"><span>require</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>image_processing/vips</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;this&nbsp;now&nbsp;generates&nbsp;the&nbsp;thumbnail&nbsp;using&nbsp;libvips</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>ImageProcessing</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>Vips</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>source</span><span class="punctuation section function ruby"><span>(</span></span><span>image</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="punctuation separator method ruby"><span>.</span></span><span>resize_to_limit!</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant numeric ruby"><span>400</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>400</span></span><span class="punctuation section function ruby"><span>)</span></span></span></div></code></pre>
<h3><a class="anchor" aria-hidden="true" id="other-processors"></a><a href="#other-processors" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Other processors</h3>
<p>In contrast to most file attachment libraries, file processing in Shrine is
just a functional transformation, where you receive the source file on the
input and return processed files on the output. This makes it easier to use
custom processing tools and encourages building generic processors that can be
reused outside of Shrine.</p>
<p>Here is an example of transcoding videos using the <a href="https://github.com/streamio/streamio-ffmpeg">streamio-ffmpeg</a> gem:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;Gemfile</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="meta require ruby"><span class="keyword other special-method ruby"><span>gem</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>streamio-ffmpeg</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>VideoUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>derivatives_processor&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>original</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;transcoded&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Tempfile</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span>&nbsp;</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>transcoded</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>.mp4</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section array end ruby"><span>]</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;screenshot&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Tempfile</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span>&nbsp;</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>screenshot</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>.jpg</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span><span class="punctuation section array end ruby"><span>]</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;movie&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>FFMPEG</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Movie</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span>original</span><span class="punctuation separator method ruby"><span>.</span></span><span>path</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;movie</span><span class="punctuation separator method ruby"><span>.</span></span><span>transcode</span><span class="punctuation section function ruby"><span>(</span></span><span>transcoded</span><span class="punctuation separator method ruby"><span>.</span></span><span>path</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;movie</span><span class="punctuation separator method ruby"><span>.</span></span><span>screenshot</span><span class="punctuation section function ruby"><span>(</span></span><span>screenshot</span><span class="punctuation separator method ruby"><span>.</span></span><span>path</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation section scope begin ruby"><span>{</span></span><span class="meta syntax ruby start-block"><span>&nbsp;</span></span><span class="constant other symbol hashkey ruby"><span>transcoded</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;transcoded</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>screenshot</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;screenshot&nbsp;</span><span class="punctuation section scope end ruby"><span>}</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>movie</span><span class="punctuation separator method ruby"><span>.</span></span><span>video_derivatives!&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;create&nbsp;derivatives</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>movie</span><span class="punctuation separator method ruby"><span>.</span></span><span>video&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::UploadedFile&nbsp;id=&quot;5a5cd0.mov&quot;&nbsp;...&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>movie</span><span class="punctuation separator method ruby"><span>.</span></span><span>video</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>transcoded</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::UploadedFile&nbsp;id=&quot;7481d6.mp4&quot;&nbsp;...&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>movie</span><span class="punctuation separator method ruby"><span>.</span></span><span>video</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>screenshot</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::UploadedFile&nbsp;id=&quot;8f3136.jpg&quot;&nbsp;...&gt;</span><span>&nbsp;</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="metadata"></a><a href="#metadata" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Metadata</h2>
<p>Shrine automatically <a href="https://shrinerb.com/docs/metadata">extracts metadata</a> from each uploaded file,
including derivatives like image thumbnails, and saves them into the database
column. In addition to filename, filesize, and MIME type that are extracted by
default, you can also extract <a href="https://shrinerb.com/docs/plugins/store_dimensions">image dimensions</a>, or your own
<a href="https://shrinerb.com/docs/plugins/add_metadata">custom metadata</a>.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>determine_mime_type</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;mime_type</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>store_dimensions</span></span><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;width&nbsp;&amp;&nbsp;height</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;add_metadata&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>resolution</span></span><span>&nbsp;</span><span class="keyword control start-block ruby"><span>do&nbsp;</span></span><span class="punctuation separator variable ruby"><span>|</span></span><span class="variable other block ruby"><span>io</span></span><span class="punctuation separator variable ruby"><span>|</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;image&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>MiniMagick</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Image</span></span><span class="punctuation separator method ruby"><span>.</span></span><span class="keyword other special-method ruby"><span>new</span></span><span class="punctuation section function ruby"><span>(</span></span><span>io</span><span class="punctuation separator method ruby"><span>.</span></span><span>path</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;image</span><span class="punctuation separator method ruby"><span>.</span></span><span>resolution</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation separator method ruby"><span>.</span></span><span>metadata&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;{</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;&quot;size&quot;&nbsp;=&gt;&nbsp;42487494,</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;&quot;filename&quot;&nbsp;=&gt;&nbsp;&quot;nature.jpg&quot;,</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;&quot;mime_type&quot;&nbsp;=&gt;&nbsp;&quot;image/jpeg&quot;,</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;&quot;width&quot;&nbsp;=&gt;&nbsp;600,</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;&quot;height&quot;&nbsp;=&gt;&nbsp;400,</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;&quot;resolution&quot;&nbsp;=&gt;&nbsp;[72,&nbsp;72],</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;&nbsp;&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;}</span><span>&nbsp;</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="validation"></a><a href="#validation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Validation</h2>
<p>For file validations there are <a href="https://shrinerb.com/docs/plugins/validation_helpers">built-in validators</a>, but
you can also just use plain Ruby code:</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>ImageUploader</span><span class="entity other inherited-class ruby"><span>&nbsp;</span><span class="punctuation separator inheritance ruby"><span>&lt;</span></span><span>&nbsp;Shrine</span></span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>validation_helpers</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>validate&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_max_size&nbsp;</span><span class="constant numeric ruby"><span>10</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span class="constant numeric ruby"><span>1024</span></span><span class="keyword operator arithmetic ruby"><span>*</span></span><span class="constant numeric ruby"><span>1024</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;validate_extension&nbsp;</span><span class="string quoted other ruby"><span class="punctuation section array begin ruby"><span>%w[</span></span><span>jpg&nbsp;jpeg&nbsp;png&nbsp;webp</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>if</span></span><span>&nbsp;validate_mime_type&nbsp;</span><span class="string quoted other interpolated ruby"><span class="punctuation section array begin ruby"><span>%W[</span></span><span>image/jpeg&nbsp;image/png&nbsp;image/webp</span><span class="punctuation section array end ruby"><span>]</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validate_max_dimensions&nbsp;</span><span class="punctuation section array begin ruby"><span>[</span></span><span class="constant numeric ruby"><span>5000</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant numeric ruby"><span>5000</span></span><span class="punctuation section array end ruby"><span>]</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>unless</span></span><span>&nbsp;</span><span class="support class ruby"><span>ImageProcessing</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>MiniMagick</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>valid_image?</span><span class="punctuation section function ruby"><span>(</span></span><span>file</span><span class="punctuation separator method ruby"><span>.</span></span><span>download</span><span class="punctuation separator method ruby"><span>.</span></span><span>path</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;error&nbsp;</span><span class="keyword operator assignment augmented ruby"><span>&lt;&lt;</span></span><span>&nbsp;</span><span class="string quoted double interpolated ruby"><span class="punctuation definition string begin ruby"><span>&quot;</span></span><span>seems&nbsp;to&nbsp;be&nbsp;corrupted</span><span class="punctuation definition string end ruby"><span>&quot;</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="backgrounding"></a><a href="#backgrounding" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Backgrounding</h2>
<p>In most file upload solutions, support for background processing was an
afterthought, which resulted in complex and unreliable implementations. Shrine
was designed with backgrounding feature in mind from day one. It is supported
via the <a href="https://shrinerb.com/docs/plugins/backgrounding"><code>backgrounding</code></a> plugin and can be used with <a href="https://github.com/shrinerb/shrine/wiki/Backgrounding-Libraries">any
backgrounding library</a>.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>plugin&nbsp;</span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>backgrounding</span></span></span></div><div class="line"><span class="source ruby"><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="support class ruby"><span>Attacher</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>promote_block&nbsp;</span><span class="keyword control start-block ruby"><span>do</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="support class ruby"><span>PromoteJob</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>perform_async</span><span class="punctuation section function ruby"><span>(</span></span><span class="variable language self ruby"><span>self</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>class</span><span class="punctuation separator method ruby"><span>.</span></span><span>name</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;record</span><span class="punctuation separator method ruby"><span>.</span></span><span>class</span><span class="punctuation separator method ruby"><span>.</span></span><span>name</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;record</span><span class="punctuation separator method ruby"><span>.</span></span><span>id</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;name</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;file_data</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span class="meta class ruby"><span class="keyword control class ruby"><span>class</span></span><span>&nbsp;</span><span class="entity name type class ruby"><span>PromoteJob</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword other special-method ruby"><span>include</span></span><span>&nbsp;</span><span class="support class ruby"><span>Sidekiq</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>Worker</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="meta function method with-arguments ruby"><span class="keyword control def ruby"><span>def</span></span><span>&nbsp;</span><span class="entity name function ruby"><span>perform</span></span><span class="punctuation definition parameters ruby"><span>(</span></span><span class="variable parameter function ruby"><span>attacher_class</span></span><span>,&nbsp;</span><span class="variable parameter function ruby"><span>record_class</span></span><span>,&nbsp;</span><span class="variable parameter function ruby"><span>record_id</span></span><span>,&nbsp;</span><span class="variable parameter function ruby"><span>name</span></span><span>,&nbsp;</span><span class="variable parameter function ruby"><span>file_data</span></span><span class="punctuation definition parameters ruby"><span>)</span></span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;attacher_class&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Object</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>const_get</span><span class="punctuation section function ruby"><span>(</span></span><span>attacher_class</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;record&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Object</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>const_get</span><span class="punctuation section function ruby"><span>(</span></span><span>record_class</span><span class="punctuation section function ruby"><span>)</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>find</span><span class="punctuation section function ruby"><span>(</span></span><span>record_id</span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;if&nbsp;using&nbsp;Active&nbsp;Record</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;attacher&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;attacher_class</span><span class="punctuation separator method ruby"><span>.</span></span><span>retrieve</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol hashkey ruby"><span>model</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;record</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>name</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;name</span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="constant other symbol hashkey ruby"><span>file</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;file_data</span><span class="punctuation section function ruby"><span>)</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;attacher</span><span class="punctuation separator method ruby"><span>.</span></span><span>create_derivatives&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;perform&nbsp;processing</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;attacher</span><span class="punctuation separator method ruby"><span>.</span></span><span>atomic_promote</span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>rescue</span></span><span>&nbsp;</span><span class="support class ruby"><span>Shrine</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>AttachmentChanged</span></span><span class="punctuation separator object ruby"><span>,</span></span><span>&nbsp;</span><span class="support class ruby"><span>ActiveRecord</span></span><span class="punctuation separator other ruby"><span>:</span><span>:</span></span><span class="variable other constant ruby"><span>RecordNotFound</span></span></span></div><div class="line"><span class="source ruby"><span class="punctuation whitespace comment leading ruby"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;attachment&nbsp;changes&nbsp;are&nbsp;detected&nbsp;for&nbsp;concurrency&nbsp;safety</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;&nbsp;</span><span class="keyword control ruby"><span>end</span></span></span></div><div class="line"><span class="source ruby"><span class="keyword control ruby"><span>end</span></span></span></div></code></pre>
<p>With Shrine, there is no need for a separate boolean column that indicates the
processing status. Processed file data is stored into the attachment database
column, which allows you to easily check whether a file has been processed.</p>
<pre><code class="language-rb"><div class="line"><span class="source ruby"><span>photo&nbsp;</span><span class="keyword operator assignment ruby"><span>=</span></span><span>&nbsp;</span><span class="support class ruby"><span>Photo</span></span><span class="punctuation separator method ruby"><span>.</span></span><span>create</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol hashkey ruby"><span>image</span><span class="punctuation definition constant ruby"><span>:</span></span></span><span>&nbsp;file</span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;background&nbsp;job&nbsp;is&nbsp;kicked&nbsp;off</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>&nbsp;</span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>large</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;nil&nbsp;(thumbnails&nbsp;are&nbsp;still&nbsp;being&nbsp;processed)</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>&nbsp;...&nbsp;sometime&nbsp;later&nbsp;...</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source ruby"><span>photo</span><span class="punctuation separator method ruby"><span>.</span></span><span>image</span><span class="punctuation section function ruby"><span>(</span></span><span class="constant other symbol ruby"><span class="punctuation definition constant ruby"><span>:</span></span><span>large</span></span><span class="punctuation section function ruby"><span>)</span></span><span>&nbsp;</span><span class="comment line number-sign ruby"><span class="punctuation definition comment ruby"><span>#</span></span><span>=&gt;&nbsp;#&lt;Shrine::UploadedFile&gt;&nbsp;(processing&nbsp;has&nbsp;finished)</span><span>&nbsp;</span></span></span></div></code></pre>
<h2><a class="anchor" aria-hidden="true" id="direct-uploads"></a><a href="#direct-uploads" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Direct Uploads</h2>
<p>For client side uploads, Shrine adopts <strong><a href="https://uppy.io">Uppy</a></strong>, a modern JavaScript file
upload library. This gives the developer a lot more power in customizing the
user experience compared to a custom JavaScript solution implemented by Refile
and Active Storage.</p>
<p>Uppy supports direct uploads to <a href="https://uppy.io/docs/aws-s3/">AWS S3</a> or to a <a href="https://uppy.io/docs/xhr-upload/">custom
endpoint</a>. It also supports <strong>resumable</strong> uploads, either
<a href="https://uppy.io/docs/aws-s3-multipart/">directly to S3</a> or via the <a href="https://tus.io">tus protocol</a>. For the
UI you can choose from various components, ranging from a simple <a href="https://uppy.io/examples/statusbar/">status
bar</a> to a full-featured <a href="https://uppy.io/examples/dashboard/">dashboard</a>.</p>
<p>Shrine provides server side components for each type of upload. They are built
on top of Rack, so that they can be used with any Ruby web framework.</p>
<table>
<thead>
<tr><th style="text-align:left">Uppy</th><th style="text-align:left">Shrine</th></tr>
</thead>
<tbody>
<tr><td style="text-align:left"><a href="https://uppy.io/docs/xhr-upload/">XHRUpload</a></td><td style="text-align:left"><a href="https://shrinerb.com/docs/plugins/upload_endpoint"><code>upload_endpoint</code></a></td></tr>
<tr><td style="text-align:left"><a href="https://uppy.io/docs/aws-s3/">AwsS3</a></td><td style="text-align:left"><a href="https://shrinerb.com/docs/plugins/presign_endpoint"><code>presign_endpoint</code></a></td></tr>
<tr><td style="text-align:left"><a href="https://uppy.io/docs/aws-s3-multipart/">AwsS3Multipart</a></td><td style="text-align:left"><a href="https://github.com/janko/uppy-s3_multipart"><code>uppy-s3_multipart</code></a></td></tr>
<tr><td style="text-align:left"><a href="https://uppy.io/docs/tus/">Tus</a></td><td style="text-align:left"><a href="https://github.com/janko/tus-ruby-server"><code>tus-ruby-server</code></a></td></tr>
</tbody>
</table>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/creating-storages"><span class="arrow-prev">← </span><span>Writing a Storage</span></a><a class="docs-next button" href="/docs/carrierwave"><span class="function-name-prevnext">Shrine for CarrierWave Users</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#generality">Generality</a></li><li><a href="#simplicity">Simplicity</a></li><li><a href="#modularity">Modularity</a><ul class="toc-headings"><li><a href="#dependencies">Dependencies</a></li></ul></li><li><a href="#inheritance">Inheritance</a></li><li><a href="#processing">Processing</a><ul class="toc-headings"><li><a href="#imagemagick">ImageMagick</a></li><li><a href="#libvips">libvips</a></li><li><a href="#other-processors">Other processors</a></li></ul></li><li><a href="#metadata">Metadata</a></li><li><a href="#validation">Validation</a></li><li><a href="#backgrounding">Backgrounding</a></li><li><a href="#direct-uploads">Direct Uploads</a></li></ul></nav></div><footer class="nav-footer" id="footer" data-version="3.0.1"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="Shrine" width="66"/></a><div><h5>Docs</h5><a href="/guides">Guides</a><a href="/plugins">Plugins</a><a href="/external">External</a><a href="https://github.com/shrinerb/shrine/blob/master/CONTRIBUTING.md#readme">Contributing</a></div><div><h5>Community</h5><a href="https://discourse.shrinerb.com" target="_blank" rel="noreferrer noopener">Discourse</a><a href="https://stackoverflow.com/questions/tagged/shrine" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://twin.github.io">Blog</a><a href="https://github.com/shrinerb/shrine">GitHub</a><a class="github-button" href="https://github.com/shrinerb/shrine" data-icon="octicon-star" data-count-href="/shrinerb/shrine/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/shrine_rb" class="twitter-follow-button">Follow @shrine_rb</a></div></div></section><section class="copyright">Copyright © 2019 Janko Marohnić</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '09a11b10801874df7d226df4f2ce8e8f',
                indexName: 'shrinerb',
                inputSelector: '#search_input_react'
              });
            </script></body></html>