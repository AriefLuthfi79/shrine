<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Shrine::Storage::FileSystem · Shrine</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The FileSystem storage handles uploads to the filesystem, and it is most"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Shrine::Storage::FileSystem · Shrine"/><meta property="og:type" content="website"/><meta property="og:url" content="https://shrinerb.com/"/><meta property="og:description" content="The FileSystem storage handles uploads to the filesystem, and it is most"/><meta property="og:image" content="https://shrinerb.com/img/logo.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://shrinerb.com/img/logo.png"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/zenburn.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-149836844-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="/js/version.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/logo.png" alt="Shrine"/><h2 class="headerTitleWithLogo">Shrine</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/getting-started" target="_self">Guides</a></li><li class=""><a href="/docs/plugins/activerecord" target="_self">Plugins</a></li><li class=""><a href="/docs/external/extensions" target="_self">External</a></li><li class=""><a href="https://discourse.shrinerb.com" target="_self">Discourse</a></li><li class=""><a href="https://github.com/shrinerb/shrine" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/shrinerb/shrine/edit/master/doc/storage/file_system.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 class="postHeaderTitle">Shrine::Storage::FileSystem</h1></header><article><div><span><p>The FileSystem storage handles uploads to the filesystem, and it is most
commonly initialized with a &quot;base&quot; folder and a &quot;prefix&quot;:</p>
<pre><code class="hljs css language-rb"><span class="hljs-keyword">require</span> <span class="hljs-string">"shrine/storage/file_system"</span>

storage = Shrine::Storage::FileSystem.new(<span class="hljs-string">"public"</span>, <span class="hljs-symbol">prefix:</span> <span class="hljs-string">"uploads"</span>)
storage.url(<span class="hljs-string">"image.jpg"</span>) <span class="hljs-comment">#=&gt; "/uploads/image.jpg"</span>
</code></pre>
<p>This storage will upload all files to &quot;public/uploads&quot;, and the URLs of the
uploaded files will start with &quot;/uploads/*&quot;. This way you can use FileSystem
for both cache and store, one having the prefix &quot;uploads/cache&quot; and other
&quot;uploads/store&quot;. If you're uploading files to the <code>public</code> directory itself,
you need to set <code>:prefix</code> to <code>&quot;/&quot;</code>:</p>
<pre><code class="hljs css language-rb">storage = Shrine::Storage::FileSystem.new(<span class="hljs-string">"public"</span>, <span class="hljs-symbol">prefix:</span> <span class="hljs-string">"/"</span>) <span class="hljs-comment"># no prefix</span>
storage.url(<span class="hljs-string">"image.jpg"</span>) <span class="hljs-comment">#=&gt; "/image.jpg"</span>
</code></pre>
<p>You can also initialize the storage just with the &quot;base&quot; directory, and then
the FileSystem storage will generate absolute URLs to files:</p>
<pre><code class="hljs css language-rb">storage = Shrine::Storage::FileSystem.new(Dir.tmpdir)
storage.url(<span class="hljs-string">"image.jpg"</span>) <span class="hljs-comment">#=&gt; "/var/folders/k7/6zx6dx6x7ys3rv3srh0nyfj00000gn/T/image.jpg"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="host"></a><a href="#host" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Host</h2>
<p>It's generally a good idea to serve your files via a CDN, so an additional
<code>:host</code> option can be provided to <code>#url</code>:</p>
<pre><code class="hljs css language-rb">storage = Shrine::Storage::FileSystem.new(<span class="hljs-string">"public"</span>, <span class="hljs-symbol">prefix:</span> <span class="hljs-string">"uploads"</span>)
storage.url(<span class="hljs-string">"image.jpg"</span>, <span class="hljs-symbol">host:</span> <span class="hljs-string">"http://abc123.cloudfront.net"</span>)
<span class="hljs-comment">#=&gt; "http://abc123.cloudfront.net/uploads/image.jpg"</span>
</code></pre>
<p>If you're not using a CDN, it's recommended that you still set <code>:host</code> to your
application's domain (at least in production).</p>
<p>The <code>:host</code> option can also be used wihout <code>:prefix</code>, and is useful if you for
example have files located on another server:</p>
<pre><code class="hljs css language-rb">storage = Shrine::Storage::FileSystem.new(<span class="hljs-string">"/opt/files"</span>)
storage.url(<span class="hljs-string">"image.jpg"</span>, <span class="hljs-symbol">host:</span> <span class="hljs-string">"http://943.23.43.1"</span>)
<span class="hljs-comment">#=&gt; "http://943.23.43.1/opt/files/image.jpg"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="moving"></a><a href="#moving" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Moving</h2>
<p>If you're uploading files on disk and want to improve performance, you can tell
the <code>FileSystem#upload</code> method to <strong>move</strong> files instead of copying them:</p>
<pre><code class="hljs css language-rb">storage.upload(file, <span class="hljs-string">"/path/to/destination"</span>, <span class="hljs-symbol">move:</span> <span class="hljs-literal">true</span>) <span class="hljs-comment"># performs the `mv` command</span>

File.exist?(file.path) <span class="hljs-comment">#=&gt; false</span>
</code></pre>
<p>If you want to make this option default, you can use the
<a href="https://shrinerb.com/docs/plugins/upload_options"><code>upload_options</code></a> plugin, provided that both <code>:cache</code> and
<code>:store</code> storages are <code>FileSystem</code>):</p>
<pre><code class="hljs css language-rb">plugin <span class="hljs-symbol">:upload_options</span>, <span class="hljs-symbol">cache:</span> { <span class="hljs-symbol">move:</span> <span class="hljs-literal">true</span> }, <span class="hljs-symbol">store:</span> { <span class="hljs-symbol">move:</span> <span class="hljs-literal">true</span> }
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="path"></a><a href="#path" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Path</h2>
<p>You can retrieve path to the file using <code>#path</code>:</p>
<pre><code class="hljs css language-rb">storage.path(<span class="hljs-string">"image.jpg"</span>) <span class="hljs-comment">#=&gt; #&lt;Pathname:public/image.jpg&gt;</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="deleting-prefixed"></a><a href="#deleting-prefixed" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deleting prefixed</h2>
<p>If you want to delete all files in some directory, you can use
<code>FileSystem#delete_prefixed</code>:</p>
<pre><code class="hljs css language-rb">storage.delete_prefixed(<span class="hljs-string">"some_directory/"</span>) <span class="hljs-comment"># deletes all files in "some_directory/"</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="clearing-cache"></a><a href="#clearing-cache" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Clearing cache</h2>
<p>If you're using FileSystem as cache, you will probably want to periodically
delete old files which aren't used anymore. You can run something like this
periodically:</p>
<pre><code class="hljs css language-rb">file_system = Shrine.storages[<span class="hljs-symbol">:cache</span>]
file_system.clear! { <span class="hljs-params">|path|</span> path.mtime &lt; Time.now - <span class="hljs-number">7</span>*<span class="hljs-number">24</span>*<span class="hljs-number">60</span>*<span class="hljs-number">60</span> } <span class="hljs-comment"># delete files older than 1 week</span>
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="permissions"></a><a href="#permissions" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Permissions</h2>
<p>The storage sets the default UNIX permissions to 0644 for files and 0755 for
directories, but you can change that:</p>
<pre><code class="hljs css language-rb">Shrine::Storage::FileSystem.new(<span class="hljs-string">"directory"</span>, <span class="hljs-symbol">permissions:</span> <span class="hljs-number">0644</span>)
Shrine::Storage::FileSystem.new(<span class="hljs-string">"directory"</span>, <span class="hljs-symbol">directory_permissions:</span> <span class="hljs-number">0755</span>)
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="heroku"></a><a href="#heroku" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Heroku</h2>
<p>Note that Heroku has a read-only filesystem, and doesn't allow you to upload
your files to the &quot;public&quot; directory, you can however upload to &quot;tmp&quot;
directory:</p>
<pre><code class="hljs css language-rb">Shrine::Storage::FileSystem.new(<span class="hljs-string">"tmp/uploads"</span>)
</code></pre>
<p>Note that this approach has a couple of downsides. For example, you can only
use it for cache, since Heroku wipes this directory between app restarts. This
also means that deploying the app can cancel someone's uploading if you're
using backgrounding. Also, by default you cannot generate URLs to files in the
&quot;tmp&quot; directory, but you can with the <code>download_endpoint</code> plugin.</p>
</span></div></article></div><div class="docs-prevnext"></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#host">Host</a></li><li><a href="#moving">Moving</a></li><li><a href="#path">Path</a></li><li><a href="#deleting-prefixed">Deleting prefixed</a></li><li><a href="#clearing-cache">Clearing cache</a></li><li><a href="#permissions">Permissions</a></li><li><a href="#heroku">Heroku</a></li></ul></nav></div><footer class="nav-footer" id="footer" data-version="3.0.0"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/logo.png" alt="Shrine" width="66"/></a><div><h5>Docs</h5><a href="/guides">Guides</a><a href="/plugins">Plugins</a><a href="/external">External</a><a href="https://github.com/shrinerb/shrine/blob/master/CONTRIBUTING.md#readme">Contributing</a></div><div><h5>Community</h5><a href="https://discourse.shrinerb.com" target="_blank" rel="noreferrer noopener">Discourse</a><a href="https://stackoverflow.com/questions/tagged/shrine" target="_blank" rel="noreferrer noopener">Stack Overflow</a></div><div><h5>More</h5><a href="https://twin.github.io">Blog</a><a href="https://github.com/shrinerb/shrine">GitHub</a><a class="github-button" href="https://github.com/shrinerb/shrine" data-icon="octicon-star" data-count-href="/shrinerb/shrine/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><div class="social"><a href="https://twitter.com/shrine_rb" class="twitter-follow-button">Follow @shrine_rb</a></div></div></section><section class="copyright">Copyright © 2019 Janko Marohnić</section></footer></div><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script></body></html>